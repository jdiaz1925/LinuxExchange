name: IPFS Hashes and File Sizes Updater

on: push

jobs:

  update-hashes:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repo
      uses: actions/checkout@v2
    - name: Get Node
      uses: actions/setup-node@v1
      with:
        node-version: '12.x'
    - name: Install libraries
      run: npm install ipfs && sed -i -e 's/http.get(url)/http.get(url, options)/g' node_modules/ipfs-utils/src/files/url-source.js
    - name: Configure Git
      run: git config --global user.name "Leo Herzog" && git config --global user.email "xd1936@gmail.com"
    - name: Add missing hashes
      run: node .github/update-ipfs-hashes-and-file-sizes.js
    - name: Add, Commit, and Push
      run: git add distros.json && git commit -m "Add Missing IPFS Hashes and File Sizes" && git push || echo "No changes"
